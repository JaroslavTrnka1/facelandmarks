from glob import glob
import torch
from face_landmarking_model import FaceLandmarking
import cv2
import os
from tqdm import tqdm


def get_jpg_files(folder_path):
    # Use glob to find all files with extension .jpg or .jpeg in the specified folder
    jpg_files = glob.glob(f"{folder_path}/*.jpg") + glob.glob(f"{folder_path}/*.jpeg")
    return jpg_files

model = FaceLandmarking()
model.load_state_dict(torch.load('model/saved_model.pth'))
model.eval()

# Tady nÄ›jak dostat adresu folder
folder_path = None

files = get_jpg_files(folder_path)
landmarks = []
# show progres?
for file in tqdm(files):
    image = cv2.imread(os.path.join(folder_path, file))
    image = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)    
    abs_output, input_landmarks, image = model.predict(image, face_detail=False)
    landmarks.append(abs_output)
    
# How to write .tps file?
# LM=72
# 302.00000 521.00000
# 300.00000 140.00000
# 297.00000 202.00000
# 327.00000 208.00000
# 271.00000 207.00000
# 350.00000 220.00000
# 248.00000 221.00000
# 297.00000 229.00000
# 311.00000 234.00000
# 285.00000 236.00000
# 330.00000 227.00000
# 267.00000 228.00000
# 299.00000 260.00000
# 319.00000 273.00000
# 279.00000 274.00000
# 337.00000 286.00000
# 265.00000 285.00000
# 272.00000 306.00000
# 327.00000 308.00000
# 262.00000 357.00000
# 198.00000 362.00000
# 227.00000 377.00000
# 228.00000 354.00000
# 214.00000 367.00000
# 240.00000 367.00000
# 252.00000 355.00000
# 341.00000 360.00000
# 405.00000 365.00000
# 377.00000 358.00000
# 376.00000 382.00000
# 389.00000 372.00000
# 363.00000 372.00000
# 353.00000 358.00000
# 168.00000 387.00000
# 273.00000 383.00000
# 434.00000 395.00000
# 328.00000 387.00000
# 348.00000 412.00000
# 383.00000 426.00000
# 415.00000 415.00000
# 357.00000 397.00000
# 382.00000 407.00000
# 410.00000 407.00000
# 189.00000 410.00000
# 224.00000 418.00000
# 253.00000 406.00000
# 193.00000 399.00000
# 220.00000 399.00000
# 245.00000 392.00000
# 137.00000 335.00000
# 142.00000 302.00000
# 151.00000 274.00000
# 161.00000 245.00000
# 171.00000 217.00000
# 186.00000 193.00000
# 206.00000 172.00000
# 234.00000 155.00000
# 264.00000 142.00000
# 462.00000 338.00000
# 459.00000 305.00000
# 453.00000 275.00000
# 445.00000 247.00000
# 436.00000 219.00000
# 422.00000 195.00000
# 398.00000 174.00000
# 371.00000 157.00000
# 337.00000 143.00000
# 297.00000 220.00000
# 324.00000 222.00000
# 273.00000 223.00000
# 227.00000 367.00000
# 376.00000 372.00000
# IMAGE=22.bmp
# ID=0 

